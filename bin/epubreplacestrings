#!/usr/bin/env python
"""
This file is meant to be used on the text based content files of an epub. This allows for the replacement of common stylistic
changes and translation errors with the desired value making later book maintenance less of a hassle.
"""

import re
import sys


def replace_strings(text):
    text = re.sub("(\. ?){2}\.", "…", text)  # proper ellipses
    text = re.sub("(?<!!)--(?!>)", "—", text)  # em dash
    text = re.sub(
        r"(B|b)y the by", r"\1y the way", text
    )  # replace By the by with its proper English idiom
    text = re.sub(
        r"(S|s)neaked", r"\1nuck", text
    )  # replace sneaked with snuck as it is more commonly used nowadays

    return text


if __name__ == "__main__":
    if len(sys.argv) >= 2:
        with open(sys.argv[1], "r+") as f:
            text = f.read()
            text = replace_strings(text)
            f.seek(0)
            f.write(text)
            f.truncate()
